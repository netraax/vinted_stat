<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vinted Stats Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- [Le reste du HTML reste identique jusqu'aux scripts] -->

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Fonctions de parsing
        function parseVintedData(text) {
            const data = {
                profile: extractProfileInfo(text),
                sales: extractSalesInfo(text),
                comments: extractComments(text),
                articles: extractArticles(text)
            };
            console.log("Données parsées:", data);
            return data;
        }

        function extractProfileInfo(text) {
            return {
                username: extractPattern(text, /([A-Za-z0-9_]+)\nÀ propos/),
                location: extractPattern(text, /À propos :\n(.*?),\sFrance/),
                followers: parseInt(extractPattern(text, /(\d+)\nAbonnés/) || '0'),
                rating: parseFloat(extractPattern(text, /(\d+\.\d+)\n\(\d+\)/) || '0'),
                evaluations: parseInt(extractPattern(text, /\((\d+)\)\nÉvaluations/) || '0')
            };
        }

        function extractSalesInfo(text) {
            const totalEvaluations = parseInt(extractPattern(text, /\((\d+)\)\nÉvaluations/) || '0');
            const actualSales = Math.floor(totalEvaluations * 0.9); // Règle des -10%
            return {
                totalSales: actualSales,
                evaluations: totalEvaluations
            };
        }

        function extractComments(text) {
            const commentRegex = /([a-zA-Z0-9_]+)\nil y a (.*?)\n(.*?)\n/g;
            const comments = [];
            let match;
            while ((match = commentRegex.exec(text)) !== null) {
                comments.push({
                    username: match[1],
                    timestamp: match[2],
                    content: match[3]
                });
            }
            return comments;
        }

        function extractArticles(text) {
            const articleRegex = /(.*?), prix : (\d+,\d+) €, marque : (.*?), taille/g;
            const articles = [];
            let match;
            while ((match = articleRegex.exec(text)) !== null) {
                articles.push({
                    name: match[1].trim(),
                    price: parseFloat(match[2].replace(',', '.')),
                    brand: match[3] !== 'Marque non spécifiée' ? match[3] : 'Autre'
                });
            }
            return articles;
        }

        function extractPattern(text, pattern) {
            const match = text.match(pattern);
            return match ? match[1] : null;
        }

        // Fonctions de visualisation
        function updateDashboard(data) {
            // Mise à jour des statistiques principales
            document.getElementById('totalSales').textContent = data.sales.totalSales;
            
            // Calcul et affichage du chiffre d'affaires
            const revenue = calculateRevenue(data.articles);
            document.getElementById('totalRevenue').textContent = formatCurrency(revenue);
            
            // Calcul et affichage du prix moyen
            const avgPrice = revenue / data.sales.totalSales;
            document.getElementById('averagePrice').textContent = formatCurrency(avgPrice);
            
            // Créer les graphiques
            createCharts(data);
        }

        function calculateRevenue(articles) {
            return articles.reduce((sum, article) => sum + article.price, 0);
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('fr-FR', {
                style: 'currency',
                currency: 'EUR'
            }).format(amount);
        }

        function createCharts(data) {
            // Création des graphiques avec Chart.js
            createSalesChart('salesChart', data);
            createEngagementChart('engagementChart', data);
            // Ajoutez d'autres graphiques ici
        }

        function createSalesChart(canvasId, data) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Ventes',
                        data: [12, 19, 3, 5, 2, 3],
                        borderColor: '#6a11cb',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const inputData = document.getElementById('inputData');
            const dashboard = document.getElementById('dashboard');

            analyzeBtn.addEventListener('click', () => {
                const rawData = inputData.value.trim();
                if (!rawData) {
                    alert('Veuillez entrer des données à analyser');
                    return;
                }

                try {
                    const parsedData = parseVintedData(rawData);
                    updateDashboard(parsedData);
                    dashboard.style.display = 'block';
                } catch (error) {
                    console.error('Erreur lors de l'analyse:', error);
                    alert('Une erreur est survenue lors de l'analyse');
                }
            });
        });
    </script>
</body>
</html>
